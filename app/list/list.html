<div class="row" style="background-color: #eee; padding-top:10px;">
	<div class="col-md-4">
		<select class="form-control" id="trench-filter" [(ngModel)]="selectedFilterTrenchId" (change)="filterByTrench()">
			<option selected value>Alle Schnitte</option>
			<option *ngFor="let trench of trenches" [id]="'trench-' + trench.resource.identifier" [value]="trench._id">{{trench.resource.identifier}}</option>
		</select>
	</div>
	<div class="col-md-4">
		<search-bar [showFiltersMenu]="true"
					[defaultFilterSet]="defaultTypes"
					(onQueryChanged)="queryChanged($event)">
		</search-bar>
	</div>
	<div class="col-md-4" align="right">
		<div *ngIf="selectedFilterTrenchId == ''" class="form-inline">
			<small>neues Dokument<br>vom Typ:</small>
			<select class="form-control ml-2" [(ngModel)]="new_doc_type">
				<option *ngFor="let type of typesList" [value]="type.name">{{type.label}}</option>
			</select>
			<button class="btn btn-secondary ml-2" (click)="addDocument(new_doc_type)" [disabled]="!new_doc_type">Hinzufügen</button>
		</div>
		<div *ngIf="selectedFilterTrenchId != ''">
			<button class="btn btn-secondary ml-2" (click)="addDocument('context')">Diesem Schnitt neuen Befund unterordnen</button>
		</div>
	</div>
</div>

<div class="row">
	<div [class.col-sm-8]="detailedDocument" [class.col-sm-12]="!detailedDocument">
	<table class=" table table-hover table-sm">
		<tr>
			<th>Typ</th>
			<th>Identifier/Id</th>
			<th>Kurzbeschreibung</th>
			<th>Neue Resource anhängen</th>
		</tr>
	    <tr *ngFor="let document of documents; let index=index;"
	        (click)="select(document)"
	        [class.synced]="document.synced"
	        [class.unsynced]="!document.synced"
			[class.bg-info]="detailedDocument == document"
	        [id]="'resource-' + document.resource.identifier">
			<td>
				{{typesMap[document.resource.type].label}}
			</td>
			<td align="right">
				<input [(ngModel)]="document.resource.identifier" (blur)="save(document)" class="form-control identifier-input">
				<small class="text-muted">{{document._id}}</small>
			</td>
			<td align="right">
            	<input [(ngModel)]="document.resource.shortDescription" (blur)="save(document)" class="form-control">
				<small><button (click)="focusDocument(document)" class="btn btn-sm btn-link">Details</button></small>
            </td>
			<td>
				<div class="form-inline">
					<select *ngIf="typesMap[document.resource.type].relations.length" class="form-control ml-2" autocomplete="off" [(ngModel)]="selectedRelation" (change)="addRelatedDocument(document, selectedRelation, $event)" >
						<option selected value></option>
						<option *ngFor="let relation of typesMap[document.resource.type].relations" [ngValue]="relation">{{relation.label}} ({{typesMap[relation.targetName].label}})</option>
					</select>
				</div>
			</td>
	    </tr>
	</table>
	</div>
	<div *ngIf="detailedDocument" class="col-sm-4 document-info px-0">
		<document-view [(document)]="detailedDocument" [basePath]="'list'">
			<description-view [document]="detailedDocument"></description-view>
			<thumbnail-view [imageIds]="currentDocument.resource.relations['depictedIn']"
							*ngIf="detailedDocument && detailedDocument.resource.relations
                            && detailedDocument.resource.relations['depictedIn']">
			</thumbnail-view>
			<geometry-view [document]="detailedDocument"></geometry-view>
			<fields-view [doc]="detailedDocument"></fields-view>
			<relations-view [doc]="detailedDocument" ></relations-view>
		</document-view>
	</div>
</div>
